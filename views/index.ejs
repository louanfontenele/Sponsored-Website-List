<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <title>Website List</title>
    <!-- TailwindCSS & DaisyUI via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@2.51.5/dist/full.css"
      rel="stylesheet" />
  </head>
  <body class="bg-white text-black">
    <nav class="p-4 border-b bg-gray-100">
      <div class="container mx-auto flex justify-between">
        <div>
          <a href="/" class="mr-4 font-bold">Home</a>
          <a href="/contact" class="mr-4">Contact</a>
        </div>
        <div>
          <a href="/login" class="btn btn-sm btn-outline">Admin</a>
        </div>
      </div>
    </nav>
    <div class="container mx-auto p-4">
      <h1 class="text-3xl font-bold mb-6">Website List</h1>

      <!-- Search field -->
      <div class="mb-4 flex gap-2">
        <input
          id="searchInput"
          type="text"
          placeholder="Search by domain"
          class="input input-bordered w-full max-w-xs" />
        <button onclick="searchLinks()" class="btn btn-primary">Search</button>
      </div>

      <div class="overflow-x-auto">
        <table class="table w-full border border-gray-300">
          <thead class="bg-gray-100">
            <tr>
              <th colspan="2" class="text-center border border-gray-300">
                Website Information
              </th>
              <th colspan="3" class="text-center border border-gray-300">
                Article Details
              </th>
              <th colspan="2" class="text-center border border-gray-300">
                Price USD
              </th>
            </tr>
            <tr>
              <th class="border border-gray-300">Domain</th>
              <th class="border border-gray-300">D.A.</th>
              <th class="border border-gray-300">Gambling</th>
              <th class="border border-gray-300">Country</th>
              <th class="border border-gray-300">Links</th>
              <th class="border border-gray-300">Gambling Price</th>
              <th class="border border-gray-300">General Price</th>
            </tr>
          </thead>
          <tbody id="table-body" class="bg-white">
            <!-- Dados carregados via JavaScript -->
          </tbody>
        </table>
      </div>
    </div>

    <script>
      function searchLinks() {
        const search = document.getElementById("searchInput").value;
        // Chama a função showLinks com o termo de busca
        showLinks(search);
      }
      function showLinks(searchTerm = "") {
        fetch("/api/links?search=" + encodeURIComponent(searchTerm))
          .then((response) => response.json())
          .then((data) => {
            const tbody = document.getElementById("table-body");
            tbody.innerHTML = "";
            data.forEach((item) => {
              const row = document.createElement("tr");
              // Cria um checkbox desabilitado para Gambling, com data-state
              const gamblingCell = document.createElement("td");
              gamblingCell.className = "border border-gray-300";
              const checkbox = document.createElement("input");
              checkbox.type = "checkbox";
              checkbox.disabled = true;
              checkbox.className = "gambling-checkbox";
              checkbox.dataset.state = item.gambling;
              gamblingCell.appendChild(checkbox);
              row.innerHTML = `
              <td class="border border-gray-300"><a href="http://${item.domain}" target="_blank" class="text-blue-500">${item.domain}</a></td>
              <td class="border border-gray-300">${item.da}</td>
            `;
              row.appendChild(gamblingCell);
              row.innerHTML += `
              <td class="border border-gray-300">${item.country}</td>
              <td class="border border-gray-300">${item.links}</td>
              <td class="border border-gray-300">$${item.gambling_price}</td>
              <td class="border border-gray-300">$${item.general_price}</td>
            `;
              tbody.appendChild(row);
            });
            // Atualiza o estado dos checkboxes
            document
              .querySelectorAll(".gambling-checkbox")
              .forEach((checkbox) => {
                const state = checkbox.dataset.state;
                if (state === "check") {
                  checkbox.checked = true;
                } else if (state === "x") {
                  checkbox.checked = false;
                  checkbox.indeterminate = true;
                } else {
                  checkbox.checked = false;
                  checkbox.indeterminate = false;
                }
              });
          });
      }
      // Carrega inicialmente
      showLinks();
    </script>
  </body>
</html>
