<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <title>Website List</title>
    <!-- TailwindCSS & DaisyUI -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@2.51.5/dist/full.css"
      rel="stylesheet" />
  </head>
  <body class="bg-white text-black">
    <nav class="p-4 border-b bg-gray-100">
      <div class="container mx-auto flex justify-between">
        <div>
          <a href="/" class="mr-4 font-bold">Home</a>
          <a href="/contact" class="mr-4">Contact</a>
        </div>
        <div>
          <a href="/login" class="btn btn-sm btn-outline">Admin</a>
        </div>
      </div>
    </nav>
    <div class="container mx-auto p-4 space-y-4">
      <h1 class="text-3xl font-bold">Website List</h1>

      <!-- Tabs -->
      <div class="tabs">
        <button
          class="tab tab-bordered"
          onclick="filterByTab('brazil_portugal')">
          Brazil & Portugal
        </button>
        <button class="tab tab-bordered" onclick="filterByTab('world')">
          World Websites
        </button>
        <button class="tab tab-bordered" onclick="filterByTab('add_links')">
          Add Links
        </button>
        <button class="tab tab-bordered" onclick="filterByTab('')">All</button>
      </div>

      <!-- Search -->
      <div class="flex gap-2 mt-4">
        <input
          id="searchInput"
          type="text"
          placeholder="Search by domain"
          class="input input-bordered w-full max-w-xs" />
        <button onclick="searchLinks()" class="btn btn-primary">Search</button>
      </div>

      <!-- Tabela -->
      <div class="overflow-x-auto mt-4">
        <table class="table w-full border border-gray-300">
          <thead class="bg-gray-100">
            <tr>
              <th colspan="2" class="text-center border p-2">
                Website Information
              </th>
              <th colspan="3" class="text-center border p-2">
                Article Details
              </th>
              <th colspan="2" class="text-center border p-2">Price USD</th>
            </tr>
            <tr>
              <th class="border p-2">Domain</th>
              <th class="border p-2">D.A.</th>
              <th class="border p-2">Gambling</th>
              <th class="border p-2">Country</th>
              <th class="border p-2">Links</th>
              <th class="border p-2">Gambling Price</th>
              <th class="border p-2">General Price</th>
            </tr>
          </thead>
          <tbody id="table-body" class="bg-white">
            <!-- Dados carregados via JavaScript -->
          </tbody>
        </table>
      </div>
    </div>

    <script>
      let currentTab = "";
      function filterByTab(tab) {
        currentTab = tab;
        loadLinks();
      }
      function searchLinks() {
        loadLinks();
      }
      function loadLinks() {
        const searchTerm = document.getElementById("searchInput").value;
        let url = "/api/links?";
        if (currentTab) {
          url += "tab=" + encodeURIComponent(currentTab) + "&";
        }
        if (searchTerm) {
          url += "search=" + encodeURIComponent(searchTerm);
        }
        fetch(url)
          .then((response) => response.json())
          .then((data) => {
            const tbody = document.getElementById("table-body");
            tbody.innerHTML = "";
            data.forEach((item) => {
              const row = document.createElement("tr");

              // Cria um checkbox desabilitado para Gambling
              const cb = document.createElement("input");
              cb.type = "checkbox";
              cb.disabled = true;
              if (item.gambling === "check") {
                cb.setAttribute("checked", "checked");
                cb.className = "checkbox checkbox-success";
              } else if (item.gambling === "x") {
                // Para "x", N√ÉO definimos "checked", apenas indeterminate
                cb.className = "checkbox checkbox-error";
              } else {
                cb.className = "checkbox";
              }
              const gamblingCell = document.createElement("td");
              gamblingCell.className = "border border-gray-300 p-2";
              gamblingCell.appendChild(cb);

              row.innerHTML = `
              <td class="border border-gray-300 p-2"><a href="http://${item.domain}" target="_blank" class="link link-primary">${item.domain}</a></td>
              <td class="border border-gray-300 p-2">${item.da}</td>
            `;
              row.appendChild(gamblingCell);
              row.innerHTML += `
              <td class="border border-gray-300 p-2">${item.country}</td>
              <td class="border border-gray-300 p-2">${item.links}</td>
              <td class="border border-gray-300 p-2">$${item.gambling_price}</td>
              <td class="border border-gray-300 p-2">$${item.general_price}</td>
            `;
              tbody.appendChild(row);
            });
            // Para cada checkbox com estado "x", setar indeterminate via JS
            document
              .querySelectorAll('input[type="checkbox"].checkbox-error')
              .forEach((cb) => {
                if (!cb.checked) {
                  cb.indeterminate = true;
                }
              });
          });
      }
      // Carrega inicialmente
      loadLinks();
    </script>
  </body>
</html>
