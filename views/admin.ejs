<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <title>Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-white text-black">
    <nav class="p-4 border-b bg-gray-100">
      <a href="/" class="mr-4">Home</a>
      <a href="/contact" class="mr-4">Contact</a>
      <a href="/admin/users" class="mr-4">User Management</a>
    </nav>
    <div class="container mx-auto p-4">
      <h1 class="text-2xl font-bold mb-4">Admin Panel - Manage Links</h1>

      <!-- Form de busca por domínio -->
      <form method="GET" action="/admin" class="mb-4">
        <input
          type="text"
          name="search"
          value="<%= search || '' %>"
          placeholder="Search by domain"
          class="border p-2" />
        <button type="submit" class="bg-gray-200 px-2 py-1">Search</button>
      </form>

      <table class="table w-full mb-4 border border-gray-300">
        <thead class="bg-gray-100">
          <tr>
            <th class="border border-gray-300">Domain</th>
            <th class="border border-gray-300">D.A.</th>
            <th class="border border-gray-300">Gambling</th>
            <th class="border border-gray-300">Country</th>
            <th class="border border-gray-300">Links</th>
            <th class="border border-gray-300">Gambling Price</th>
            <th class="border border-gray-300">General Price</th>
            <th class="border border-gray-300">Tab</th>
            <th class="border border-gray-300">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% links.forEach(link => { %>
          <tr>
            <td class="border border-gray-300"><%= link.domain %></td>
            <td class="border border-gray-300"><%= link.da %></td>
            <td class="border border-gray-300"><%= link.gambling %></td>
            <td class="border border-gray-300"><%= link.country %></td>
            <td class="border border-gray-300"><%= link.links %></td>
            <td class="border border-gray-300">$<%= link.gambling_price %></td>
            <td class="border border-gray-300">$<%= link.general_price %></td>
            <td class="border border-gray-300"><%= link.tab %></td>
            <td class="border border-gray-300">
              <!-- Remover link -->
              <form
                action="/admin/delete/<%= link.id %>"
                method="POST"
                style="display: inline">
                <button class="bg-red-500 text-white px-2 py-1" type="submit">
                  Delete
                </button>
              </form>
              <!-- Botão de edição (placeholder para implementação) -->
              <button
                onclick="alert('Edit functionality for ID: <%= link.id %> to be implemented')"
                class="bg-blue-500 text-white px-2 py-1">
                Edit
              </button>
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>

      <h2 class="text-xl mb-2">Add New Link</h2>
      <form
        action="/admin/add"
        method="POST"
        class="bg-gray-100 p-4 rounded shadow">
        <div class="grid grid-cols-2 gap-4">
          <!-- Domain -->
          <div>
            <label>Domain:</label>
            <input
              type="text"
              name="domain"
              class="border p-2 w-full"
              required />
          </div>
          <!-- D.A. (somente números inteiros) -->
          <div>
            <label>D.A.:</label>
            <input
              type="number"
              name="da"
              step="1"
              class="border p-2 w-full"
              required />
          </div>
          <!-- Gambling (Checkbox tri-state) -->
          <div>
            <label>Gambling:</label>
            <div class="flex items-center">
              <input type="checkbox" id="gamblingCheckbox" />
              <input
                type="hidden"
                name="gambling"
                id="gamblingValue"
                value="unchecked" />
            </div>
          </div>
          <!-- Country -->
          <div>
            <label>Country:</label>
            <input
              type="text"
              name="country"
              class="border p-2 w-full"
              required />
          </div>
          <!-- Links (somente inteiros) -->
          <div>
            <label>Links:</label>
            <input
              type="number"
              name="links"
              step="1"
              class="border p-2 w-full"
              required />
          </div>
          <!-- Gambling Price (números decimais) -->
          <div>
            <label>Gambling Price (USD):</label>
            <input
              type="number"
              step="0.01"
              min="0"
              name="gambling_price"
              class="border p-2 w-full"
              required />
          </div>
          <!-- General Price (números decimais) -->
          <div>
            <label>General Price (USD):</label>
            <input
              type="number"
              step="0.01"
              min="0"
              name="general_price"
              class="border p-2 w-full"
              required />
          </div>
          <!-- Tab (Dropdown) -->
          <div>
            <label>Tab:</label>
            <select name="tab" class="border p-2 w-full" required>
              <option value="brazil_portugal">Brazil &amp; Portugal</option>
              <option value="world">World Websites</option>
              <option value="add_links">Add Links</option>
            </select>
          </div>
        </div>
        <button type="submit" class="mt-4 bg-green-500 text-white px-4 py-2">
          Add Link
        </button>
      </form>
    </div>

    <script>
      // Implementa um checkbox tri-state usando o input type="checkbox"
      const gamblingCheckbox = document.getElementById("gamblingCheckbox");
      const gamblingValue = document.getElementById("gamblingValue");
      // Estado inicial: unchecked
      gamblingCheckbox.checked = false;
      gamblingCheckbox.indeterminate = false;

      gamblingCheckbox.addEventListener("click", function (e) {
        // Se não estiver marcado e não estiver em estado indeterminado, seta para checked ("check")
        if (!gamblingCheckbox.checked && !gamblingCheckbox.indeterminate) {
          gamblingCheckbox.checked = true;
          gamblingCheckbox.indeterminate = false;
          gamblingValue.value = "check";
        } else if (
          gamblingCheckbox.checked &&
          !gamblingCheckbox.indeterminate
        ) {
          // Se estiver marcado, seta para indeterminado ("x")
          gamblingCheckbox.checked = false;
          gamblingCheckbox.indeterminate = true;
          gamblingValue.value = "x";
        } else {
          // Se estiver em estado indeterminado, reseta para unchecked
          gamblingCheckbox.checked = false;
          gamblingCheckbox.indeterminate = false;
          gamblingValue.value = "unchecked";
        }
      });
    </script>
  </body>
</html>
