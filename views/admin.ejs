<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <title>Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-white text-black">
    <nav class="p-4 border-b bg-gray-100">
      <div class="container mx-auto flex justify-between">
        <div>
          <a href="/" class="mr-4 font-bold">Home</a>
          <a href="/contact" class="mr-4">Contact</a>
        </div>
        <div>
          <a href="/admin/users" class="btn btn-sm btn-outline mr-2"
            >User Management</a
          >
          <a href="/login" class="btn btn-sm btn-outline">Logout</a>
        </div>
      </div>
    </nav>
    <div class="container mx-auto p-4 space-y-6">
      <!-- Card de Adicionar e Buscar -->
      <div class="card bg-base-200 shadow-lg p-4">
        <h2 class="card-title mb-4">Add New Link</h2>
        <form action="/admin/add" method="POST" class="space-y-4">
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="label">Domain:</label>
              <input
                type="text"
                name="domain"
                class="input input-bordered w-full"
                required />
            </div>
            <div>
              <label class="label">D.A.:</label>
              <input
                type="number"
                name="da"
                step="1"
                class="input input-bordered w-full"
                required />
            </div>
            <div>
              <label class="label">Gambling:</label>
              <div class="flex items-center gap-2">
                <button type="button" id="gamblingButton" class="btn btn-ghost">
                  ⬜
                </button>
                <input
                  type="hidden"
                  name="gambling"
                  id="gamblingValue"
                  value="unchecked" />
              </div>
            </div>
            <div>
              <label class="label">Country:</label>
              <input
                type="text"
                name="country"
                class="input input-bordered w-full"
                required />
            </div>
            <div>
              <label class="label">Links:</label>
              <input
                type="number"
                name="links"
                step="1"
                class="input input-bordered w-full"
                required />
            </div>
            <div>
              <label class="label">Gambling Price (USD):</label>
              <input
                type="number"
                step="0.01"
                min="0"
                name="gambling_price"
                class="input input-bordered w-full"
                required />
            </div>
            <div>
              <label class="label">General Price (USD):</label>
              <input
                type="number"
                step="0.01"
                min="0"
                name="general_price"
                class="input input-bordered w-full"
                required />
            </div>
            <div>
              <label class="label">Tab:</label>
              <select name="tab" class="select select-bordered w-full" required>
                <option value="brazil_portugal">Brazil &amp; Portugal</option>
                <option value="world">World Websites</option>
                <option value="add_links">Add Links</option>
              </select>
            </div>
          </div>
          <button type="submit" class="btn btn-success w-full">Add Link</button>
        </form>
        <!-- Busca -->
        <div class="mt-4 flex gap-2">
          <input
            id="searchInput"
            type="text"
            placeholder="Search by domain"
            class="input input-bordered w-full max-w-xs" />
          <button onclick="searchLinks()" class="btn btn-primary">
            Search
          </button>
        </div>
      </div>

      <!-- Lista de links -->
      <div
        class="card bg-base-200 shadow-lg p-4 overflow-auto"
        style="max-height: 400px">
        <table class="table w-full">
          <thead class="bg-gray-100">
            <tr>
              <th class="border">Domain</th>
              <th class="border">D.A.</th>
              <th class="border">Gambling</th>
              <th class="border">Country</th>
              <th class="border">Links</th>
              <th class="border">Gambling Price</th>
              <th class="border">General Price</th>
              <th class="border">Tab</th>
              <th class="border">Actions</th>
            </tr>
          </thead>
          <tbody id="linkTableBody">
            <!-- Dados carregados via JavaScript -->
          </tbody>
        </table>
      </div>
    </div>

    <script>
      // Tri-state para botão Gambling no form de add
      const gamblingButton = document.getElementById("gamblingButton");
      const gamblingValue = document.getElementById("gamblingValue");
      const states = ["unchecked", "check", "x"];
      const emojiMap = {
        unchecked: "⬜",
        check: "✅",
        x: "❌",
      };
      gamblingButton.textContent = emojiMap[gamblingValue.value];
      gamblingButton.addEventListener("click", function () {
        let index = states.indexOf(gamblingValue.value);
        index = (index + 1) % states.length;
        const newState = states[index];
        gamblingValue.value = newState;
        gamblingButton.textContent = emojiMap[newState];
      });

      // Função para carregar a lista de links (usada na busca do admin)
      function loadLinks(searchTerm = "") {
        fetch("/api/links?search=" + encodeURIComponent(searchTerm))
          .then((response) => response.json())
          .then((data) => {
            const tbody = document.getElementById("linkTableBody");
            tbody.innerHTML = "";
            data.forEach((item) => {
              const row = document.createElement("tr");
              // Cria checkbox para Gambling (estático)
              const gamblingCell = document.createElement("td");
              const cb = document.createElement("input");
              cb.type = "checkbox";
              cb.disabled = true;
              cb.dataset.state = item.gambling;
              if (item.gambling === "check") {
                cb.checked = true;
              } else if (item.gambling === "x") {
                cb.indeterminate = true;
              }
              gamblingCell.appendChild(cb);
              row.innerHTML = `
              <td class="border p-2">${item.domain}</td>
              <td class="border p-2">${item.da}</td>
            `;
              row.appendChild(gamblingCell);
              row.innerHTML += `
              <td class="border p-2">${item.country}</td>
              <td class="border p-2">${item.links}</td>
              <td class="border p-2">$${item.gambling_price}</td>
              <td class="border p-2">$${item.general_price}</td>
              <td class="border p-2">${item.tab}</td>
              <td class="border p-2">
                <a href="/admin/edit/${item.id}" class="btn btn-sm btn-info mr-2">Edit</a>
                <form action="/admin/delete/${item.id}" method="POST" class="inline-block">
                  <button class="btn btn-sm btn-error" type="submit">Delete</button>
                </form>
              </td>
            `;
              tbody.appendChild(row);
            });
            // Atualiza os checkboxes
            document
              .querySelectorAll('input[type="checkbox"][data-state]')
              .forEach((cb) => {
                const state = cb.dataset.state;
                if (state === "check") {
                  cb.checked = true;
                  cb.indeterminate = false;
                } else if (state === "x") {
                  cb.checked = false;
                  cb.indeterminate = true;
                } else {
                  cb.checked = false;
                  cb.indeterminate = false;
                }
              });
          });
      }
      function searchLinks() {
        const searchTerm = document.getElementById("searchInput").value;
        loadLinks(searchTerm);
      }
      // Carrega inicialmente
      loadLinks();
    </script>
  </body>
</html>
